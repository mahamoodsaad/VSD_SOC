## Final steps for RTL2GDS using tritonRoute and openSTA

## What is Routing?

Routing is the **physical implementation of electrical connections** between standard cells, macros, and I/O pins using **metal layers and vias**. It converts the logical connections from the netlist into actual on-chip wiring after placement and Clock Tree Synthesis (CTS). Routing is a critical stage that impacts **functionality, timing closure, signal integrity, and manufacturability** of the chip.

---

## Goals of Routing

* Ensure all netlist-defined signal connections are completed.
* Avoid **DRC (Design Rule Check)** violations.
* Reduce routing congestion and minimize via usage.
* Enhance timing by optimizing **critical paths**.
* Guarantee **LVS (Layout vs. Schematic)** and signal integrity compliance.
* Maintain proper separation of signal lines from **power and ground (P/G)** routing.

---

## Routing Flow

1. **Global Routing**

   * Divides the layout into coarse grid cells.
   * Assigns approximate paths for nets while avoiding congestion, power/ground lines, and macro blockages.

2. **Track Assignment (TA)**

   * Maps nets to specific routing tracks.
   * Optimizes for fewer vias and straighter wire segments.
   * DRC checks are not enforced at this stage.

3. **Detail Routing**

   * Defines the exact geometry of wires and vias.
   * Fixes DRC violations (spacing, width, enclosure, etc.).
   * Performs **timing-aware optimizations**.
   * ✅ Final result: a **DRC-clean**, fully connected layout ready for **parasitic extraction and signoff STA**.

---

## TritonRoute

TritonRoute is the **detailed router** in the OpenROAD/OpenLane flow. It works by:

* Using **global routing guides** as input.
* Employing a **MILP-based panel routing strategy**.
* Supporting **intra-layer parallel routing** (multiple regions of the same metal layer routed simultaneously).
* Supporting **inter-layer sequential routing** (routing layers one at a time, from lower to higher metal levels).
* Following each layer’s **preferred routing direction** from the LEF file (e.g., M1: horizontal, M2: vertical).

This approach reduces congestion, lowers parasitic capacitance, and improves **signal integrity and manufacturability**.

---

## TritonRoute – Key Features

TritonRoute operates using **pre-processed route guides** generated by the global router. These guides act as high-level blueprints that the detailed router follows, improving both **efficiency** and **routing quality**.

---

### Preprocessing Steps for Route Guides

1. Generate initial guides based on **pin locations** (e.g., from point A to point B).
2. Split wide routing segments into **unit-width segments** aligned with preferred directions.
3. Merge **overlapping or redundant** segments.
4. Insert bridges for **inter-layer connections** (e.g., from M1 to M2).
5. Produce optimized, preprocessed guides ready for detailed routing.

---

### Preferred Routing Directions

* **Metal1 (M1): Vertical**
* **Metal2 (M2): Horizontal**

Following these directions helps reduce congestion, minimize via usage, and maintain DRC compliance.

---

### Requirements of Preprocessed Guides

* Must be **unit width**.
* Must follow the **preferred routing direction** for each metal layer.

---

✅ **Result**: With optimized route guides, TritonRoute achieves high-quality, DRC-clean routing while balancing efficiency, via count, and signal integrity.

---
<img width="655" height="351" alt="Screenshot 2025-10-01 at 4 39 46 PM" src="https://github.com/user-attachments/assets/0c2c3c9a-e0ea-4748-9b0c-bdee772dff16" />


## Inter-Guide Connectivity in TritonRoute

In TritonRoute, **inter-guide connectivity** ensures continuous electrical paths across route guides, preventing breaks in signal flow. This mechanism is critical for achieving seamless routing across guide boundaries.

### Conditions for Connectivity

* **Same Layer Connectivity**: Two guides are connected if they lie on the same metal layer and share touching edges.
* **Adjacent Layer Connectivity**: Two guides are connected if they belong to adjacent metal layers and have a **non-zero vertical overlap area**.

### Terminal Access

* Every unconnected terminal (standard-cell pin) must be **covered by at least one route guide**, guaranteeing that the router can legally access and connect it.

### Benefits

* Prevents routing discontinuities.
* Eliminates open (floating) connections.
* Enhances design reliability and routability.

---

⚡ **In short**: Inter-guide connectivity ensures that route guides form a consistent and reliable network, enabling TritonRoute to create fully connected, manufacturable layouts.

---

## Routing Topology Algorithm

The **Routing Topology Algorithm** defines how pins (or Access Points for Connections, APCs) are interconnected in an integrated circuit. Its goal is to find the most **efficient and cost-effective** routing structure that minimizes wirelength while ensuring complete connectivity.

---

### Key Steps

1. **Distance Calculation**

   * Compute pairwise distances between all pin access points.
   * Cost function:
     [
     cost(i, j) = dist(APC_i, APC_j)
     ]

2. **Minimum Spanning Tree (MST)**

   * Construct an MST from the distance cost matrix.
   * The MST guarantees full connectivity with the **minimum total wirelength**.

3. **Topology Extraction**

   * Extract the set of MST edges as the **optimal routing topology**.

---

✅ **Result**: The Routing Topology Algorithm produces a minimal wirelength interconnect structure, serving as the blueprint for detailed routing.

---

* Perform detailed routing using TritonRoute and explore the routed layout`

```shell
# Check value of 'CURRENT_DEF'
echo $::env(CURRENT_DEF)
# Check value of 'ROUTING_STRATEGY'
echo $::env(ROUTING_STRATEGY)
run_routing
```
* load routed def in magic in another terminal:

```shell
# Change directory to path containing routed def
cd ~/soc-design-and-planning-nasscom-vsd/Desktop/work/tools/openlane_working_dir/openlane/designs/picorv32a/runs/30-09_06-19/results/routing

# Command to load the routed def in magic tool
magic -T /home/saad/soc-design-and-planning-nasscom-vsd/Desktop/work/tools/openlane_working_dir/pdks/sky130A/libs.tech/magic/sky130A.tech lef read ../../tmp/merged.lef def read picorv32a.def &
```
<img width="1200" height="772" alt="Screenshot 2025-10-01 at 4 27 17 PM" src="https://github.com/user-attachments/assets/59eb5232-4780-40b9-a7a8-32194c219d69" />
<img width="1200" height="767" alt="Screenshot 2025-10-01 at 4 28 07 PM" src="https://github.com/user-attachments/assets/5ab6f9b4-a912-407e-9e56-44e576efdc90" />
<img width="1220" height="796" alt="Screenshot 2025-10-01 at 4 29 40 PM" src="https://github.com/user-attachments/assets/44217db4-90b4-42fe-ab88-8e85f6f00e13" />

Screenshot of fast route guide present
<img width="1186" height="722" alt="Screenshot 2025-10-01 at 4 31 31 PM" src="https://github.com/user-attachments/assets/ae3f121e-66d6-4536-959f-475e8911f321" />

* Post-Route parasitic extraction using SPEF extractor`

```shell
cd ~/soc-design-and-planning-nasscom-vsd/Desktop/work/tools/openlane_working_dir/openlane/scripts/spef_extractor
python3 main.py -l /home/saad/soc-design-and-planning-nasscom-vsd/Desktop/work/tools/openlane_working_dir/openlane/designs/picorv32a/runs/30-09_06-19/tmp/merged.lef -d /home/spatha/soc-design-and-planning-nasscom-vsd/Desktop/work/tools/openlane_working_dir/openlane/designs/picorv32a/runs/19-07_00-15/results/routing/picorv32a.def
```
<img width="1204" height="357" alt="Screenshot 2025-10-01 at 7 22 35 PM" src="https://github.com/user-attachments/assets/70ba4617-46e0-4c74-8862-d634930d41d8" />

Screenshot of spef extracted:
<img width="1206" height="677" alt="Screenshot 2025-10-01 at 7 23 35 PM" src="https://github.com/user-attachments/assets/d8f3a535-57ea-482c-b9c9-a2f503b6b686" />

* Post-Route OpenSTA timing analysis with the extracted parasitics of the route`

```shell
openroad

read_lef /openLANE_flow/designs/picorv32a/runs/30-09_06-19/tmp/merged.lef

read_def /openLANE_flow/designs/picorv32a/runs/30-09_06-19/results/routing/picorv32a.def

write_db pico_route.db

read_db pico_route.db

read_verilog /openLANE_flow/designs/picorv32a/runs/30-09_06-19/results/synthesis/picorv32a.synthesis_preroute.v

read_liberty $::env(LIB_SYNTH_COMPLETE)
link_design picorv32a

read_sdc /openLANE_flow/designs/picorv32a/src/my_base.sdc

set_propagated_clock [all_clocks]

read_spef /openLANE_flow/designs/picorv32a/runs/30-09_06-19/results/routing/picorv32a.spef

report_checks -path_delay min_max -fields {slew trans net cap input_pins} -format full_clock_expanded -digits 4

exit
```

```shell
% report_checks -path_delay min_max -fields {slew trans net cap input_pins} -format full_clock_expanded -digits 4
Startpoint: _34465_ (rising edge-triggered flip-flop clocked by clk)
Endpoint: _34467_ (rising edge-triggered flip-flop clocked by clk)
Path Group: clk
Path Type: min

Fanout       Cap      Slew     Delay      Time   Description
-------------------------------------------------------------------------------------
                              0.0000    0.0000   clock clk (rise edge)
                              0.0000    0.0000   clock source latency
                    0.0921    0.0728    0.0728 ^ clk (in)
     2    0.0580                                 clk (net)
                    0.0990    0.0000    0.0728 ^ clkbuf_0_clk/A (sky130_fd_sc_hd__clkbuf_16)
                    0.0329    0.1352    0.2080 ^ clkbuf_0_clk/X (sky130_fd_sc_hd__clkbuf_16)
     2    0.0094                                 clknet_0_clk (net)
                    0.0329    0.0001    0.2081 ^ clkbuf_1_1_0_clk/A (sky130_fd_sc_hd__clkbuf_2)
                    0.0603    0.1118    0.3200 ^ clkbuf_1_1_0_clk/X (sky130_fd_sc_hd__clkbuf_2)
     1    0.0094                                 clknet_1_1_0_clk (net)
                    0.0603    0.0005    0.3205 ^ clkbuf_1_1_1_clk/A (sky130_fd_sc_hd__clkbuf_2)
                    0.0546    0.1173    0.4378 ^ clkbuf_1_1_1_clk/X (sky130_fd_sc_hd__clkbuf_2)
     1    0.0082                                 clknet_1_1_1_clk (net)
                    0.0546    0.0004    0.4382 ^ clkbuf_1_1_2_clk/A (sky130_fd_sc_hd__clkbuf_2)
                    0.0503    0.1120    0.5502 ^ clkbuf_1_1_2_clk/X (sky130_fd_sc_hd__clkbuf_2)
     2    0.0074                                 clknet_1_1_2_clk (net)
                    0.0503    0.0002    0.5504 ^ clkbuf_2_2_0_clk/A (sky130_fd_sc_hd__clkbuf_2)
                    0.0562    0.1149    0.6653 ^ clkbuf_2_2_0_clk/X (sky130_fd_sc_hd__clkbuf_2)
     1    0.0085                                 clknet_2_2_0_clk (net)
                    0.0562    0.0005    0.6657 ^ clkbuf_2_2_1_clk/A (sky130_fd_sc_hd__clkbuf_2)
                    0.0566    0.1173    0.7830 ^ clkbuf_2_2_1_clk/X (sky130_fd_sc_hd__clkbuf_2)
     1    0.0086                                 clknet_2_2_1_clk (net)
                    0.0566    0.0004    0.7834 ^ clkbuf_2_2_2_clk/A (sky130_fd_sc_hd__clkbuf_2)
                    0.0604    0.1205    0.9040 ^ clkbuf_2_2_2_clk/X (sky130_fd_sc_hd__clkbuf_2)
     2    0.0094                                 clknet_2_2_2_clk (net)
                    0.0604    0.0001    0.9041 ^ clkbuf_3_5_0_clk/A (sky130_fd_sc_hd__clkbuf_2)
                    0.0464    0.1111    1.0152 ^ clkbuf_3_5_0_clk/X (sky130_fd_sc_hd__clkbuf_2)
     1    0.0066                                 clknet_3_5_0_clk (net)
                    0.0464    0.0002    1.0154 ^ clkbuf_3_5_1_clk/A (sky130_fd_sc_hd__clkbuf_2)
                    0.0241    0.0866    1.1020 ^ clkbuf_3_5_1_clk/X (sky130_fd_sc_hd__clkbuf_2)
     2    0.0019                                 clknet_3_5_1_clk (net)
                    0.0241    0.0000    1.1020 ^ clkbuf_4_11_0_clk/A (sky130_fd_sc_hd__clkbuf_2)
                    0.0605    0.1091    1.2110 ^ clkbuf_4_11_0_clk/X (sky130_fd_sc_hd__clkbuf_2)
     2    0.0094                                 clknet_4_11_0_clk (net)
                    0.0605    0.0001    1.2111 ^ clkbuf_5_23_0_clk/A (sky130_fd_sc_hd__clkbuf_2)
                    0.0358    0.1027    1.3138 ^ clkbuf_5_23_0_clk/X (sky130_fd_sc_hd__clkbuf_2)
     1    0.0044                                 clknet_5_23_0_clk (net)
                    0.0358    0.0001    1.3139 ^ clkbuf_5_23_1_clk/A (sky130_fd_sc_hd__clkbuf_2)
                    0.1298    0.1622    1.4761 ^ clkbuf_5_23_1_clk/X (sky130_fd_sc_hd__clkbuf_2)
    10    0.0229                                 clknet_5_23_1_clk (net)
                    0.1298    0.0000    1.4761 ^ clkbuf_leaf_164_clk/A (sky130_fd_sc_hd__clkbuf_16)
                    0.0299    0.1425    1.6187 ^ clkbuf_leaf_164_clk/X (sky130_fd_sc_hd__clkbuf_16)
    10    0.0060                                 clknet_leaf_164_clk (net)
                    0.0299    0.0000    1.6187 ^ _34465_/CLK (sky130_fd_sc_hd__dfxtp_2)
                    0.0758    0.3516    1.9702 v _34465_/Q (sky130_fd_sc_hd__dfxtp_2)
     5    0.0280                                 count_instr[32] (net)
                    0.0758    0.0006    1.9709 v _17337_/C (sky130_fd_sc_hd__nand3_4)
                    0.0367    0.0903    2.0611 ^ _17337_/Y (sky130_fd_sc_hd__nand3_4)
     2    0.0065                                 _13875_ (net)
                    0.0367    0.0000    2.0611 ^ _17404_/A2 (sky130_fd_sc_hd__a21oi_1)
                    0.0277    0.0538    2.1149 v _17404_/Y (sky130_fd_sc_hd__a21oi_1)
     1    0.0025                                 _03899_ (net)
                    0.0277    0.0000    2.1149 v _34467_/D (sky130_fd_sc_hd__dfxtp_1)
                                        2.1149   data arrival time

                              0.0000    0.0000   clock clk (rise edge)
                              0.0000    0.0000   clock source latency
                    0.0921    0.0728    0.0728 ^ clk (in)
     2    0.0580                                 clk (net)
                    0.0990    0.0000    0.0728 ^ clkbuf_0_clk/A (sky130_fd_sc_hd__clkbuf_16)
                    0.0329    0.1352    0.2080 ^ clkbuf_0_clk/X (sky130_fd_sc_hd__clkbuf_16)
     2    0.0094                                 clknet_0_clk (net)
                    0.0329    0.0001    0.2081 ^ clkbuf_1_1_0_clk/A (sky130_fd_sc_hd__clkbuf_2)
                    0.0603    0.1118    0.3200 ^ clkbuf_1_1_0_clk/X (sky130_fd_sc_hd__clkbuf_2)
     1    0.0094                                 clknet_1_1_0_clk (net)
                    0.0603    0.0005    0.3205 ^ clkbuf_1_1_1_clk/A (sky130_fd_sc_hd__clkbuf_2)
                    0.0546    0.1173    0.4378 ^ clkbuf_1_1_1_clk/X (sky130_fd_sc_hd__clkbuf_2)
     1    0.0082                                 clknet_1_1_1_clk (net)
                    0.0546    0.0004    0.4382 ^ clkbuf_1_1_2_clk/A (sky130_fd_sc_hd__clkbuf_2)
                    0.0503    0.1120    0.5502 ^ clkbuf_1_1_2_clk/X (sky130_fd_sc_hd__clkbuf_2)
     2    0.0074                                 clknet_1_1_2_clk (net)
                    0.0503    0.0002    0.5504 ^ clkbuf_2_2_0_clk/A (sky130_fd_sc_hd__clkbuf_2)
                    0.0562    0.1149    0.6653 ^ clkbuf_2_2_0_clk/X (sky130_fd_sc_hd__clkbuf_2)
     1    0.0085                                 clknet_2_2_0_clk (net)
                    0.0562    0.0005    0.6657 ^ clkbuf_2_2_1_clk/A (sky130_fd_sc_hd__clkbuf_2)
                    0.0566    0.1173    0.7830 ^ clkbuf_2_2_1_clk/X (sky130_fd_sc_hd__clkbuf_2)
     1    0.0086                                 clknet_2_2_1_clk (net)
                    0.0566    0.0004    0.7834 ^ clkbuf_2_2_2_clk/A (sky130_fd_sc_hd__clkbuf_2)
                    0.0604    0.1205    0.9040 ^ clkbuf_2_2_2_clk/X (sky130_fd_sc_hd__clkbuf_2)
     2    0.0094                                 clknet_2_2_2_clk (net)
                    0.0604    0.0001    0.9041 ^ clkbuf_3_5_0_clk/A (sky130_fd_sc_hd__clkbuf_2)
                    0.0464    0.1111    1.0152 ^ clkbuf_3_5_0_clk/X (sky130_fd_sc_hd__clkbuf_2)
     1    0.0066                                 clknet_3_5_0_clk (net)
                    0.0464    0.0002    1.0154 ^ clkbuf_3_5_1_clk/A (sky130_fd_sc_hd__clkbuf_2)
                    0.0241    0.0866    1.1020 ^ clkbuf_3_5_1_clk/X (sky130_fd_sc_hd__clkbuf_2)
     2    0.0019                                 clknet_3_5_1_clk (net)
                    0.0241    0.0000    1.1020 ^ clkbuf_4_10_0_clk/A (sky130_fd_sc_hd__clkbuf_2)
                    0.0594    0.1082    1.2102 ^ clkbuf_4_10_0_clk/X (sky130_fd_sc_hd__clkbuf_2)
     2    0.0092                                 clknet_4_10_0_clk (net)
                    0.0594    0.0001    1.2103 ^ clkbuf_5_21_0_clk/A (sky130_fd_sc_hd__clkbuf_2)
                    0.0373    0.1035    1.3138 ^ clkbuf_5_21_0_clk/X (sky130_fd_sc_hd__clkbuf_2)
     1    0.0047                                 clknet_5_21_0_clk (net)
                    0.0373    0.0001    1.3140 ^ clkbuf_5_21_1_clk/A (sky130_fd_sc_hd__clkbuf_2)
                    0.4424    0.3762    1.6902 ^ clkbuf_5_21_1_clk/X (sky130_fd_sc_hd__clkbuf_2)
    10    0.0825                                 clknet_5_21_1_clk (net)
                    0.4424    0.0024    1.6927 ^ clkbuf_leaf_174_clk/A (sky130_fd_sc_hd__clkbuf_16)
                    0.0475    0.2263    1.9190 ^ clkbuf_leaf_174_clk/X (sky130_fd_sc_hd__clkbuf_16)
     6    0.0163                                 clknet_leaf_174_clk (net)
                    0.0475    0.0003    1.9192 ^ _34467_/CLK (sky130_fd_sc_hd__dfxtp_1)
                              0.0000    1.9192   clock reconvergence pessimism
                             -0.0457    1.8735   library hold time
                                        1.8735   data required time
-------------------------------------------------------------------------------------
                                        1.8735   data required time
                                       -2.1149   data arrival time
-------------------------------------------------------------------------------------
                                        0.2414   slack (MET)


Startpoint: resetn (input port clocked by clk)
Endpoint: mem_la_read (output port clocked by clk)
Path Group: clk
Path Type: max

Fanout       Cap      Slew     Delay      Time   Description
-------------------------------------------------------------------------------------
                              0.0000    0.0000   clock clk (rise edge)
                              0.0000    0.0000   clock network delay (propagated)
                              4.9460    4.9460 ^ input external delay
                    0.0172    0.0055    4.9515 ^ resetn (in)
     1    0.0042                                 resetn (net)
                    0.0172    0.0000    4.9515 ^ input101/A (sky130_fd_sc_hd__clkbuf_8)
                    0.1378    0.1786    5.1301 ^ input101/X (sky130_fd_sc_hd__clkbuf_8)
     8    0.0748                                 net101 (net)
                    0.1422    0.0194    5.1494 ^ _18399_/C (sky130_fd_sc_hd__nand3_4)
                    0.0960    0.1085    5.2579 v _18399_/Y (sky130_fd_sc_hd__nand3_4)
     4    0.0158                                 _14568_ (net)
                    0.0960    0.0005    5.2584 v _20942_/B1 (sky130_fd_sc_hd__a21oi_4)
                    0.3600    0.3218    5.5802 ^ _20942_/Y (sky130_fd_sc_hd__a21oi_4)
     2    0.0485                                 net199 (net)
                    0.3604    0.0090    5.5891 ^ output199/A (sky130_fd_sc_hd__buf_2)
                    0.1009    0.2310    5.8202 ^ output199/X (sky130_fd_sc_hd__buf_2)
    1    0.0177                                 mem_la_read (net)
                    0.1009    0.0003    5.8205 ^ mem_la_read (out)
                                        5.8205   data arrival time

                             24.7300   24.7300   clock clk (rise edge)
                              0.0000   24.7300   clock network delay (propagated)
                              0.0000   24.7300   clock reconvergence pessimism
                             -4.9460   19.7840   output external delay
                                       19.7840   data required time
-------------------------------------------------------------------------------------
                                       19.7840   data required time
                                       -5.8205   data arrival time
-------------------------------------------------------------------------------------
                                       13.9635   slack (MET)


% exit
```
